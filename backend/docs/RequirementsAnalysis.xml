<RequirementsAnalysis version="2.0">
  <Domain id="windows-doors-ecommerce">
    <Description>
      Web application for configurable windows and doors with pricing, cart/checkout,
      orders, installation scheduling, and lifecycle notifications across B2C/B2B users.
    </Description>
  </Domain>

  <Actors>
    <Actor id="CUSTOMER">
      <Name>Customer</Name>
      <Goals>
        <Goal id="G-BROWSE">Browse and search catalog</Goal>
        <Goal id="G-CONFIGURE">Configure a valid window/door</Goal>
        <Goal id="G-BUY">Place and pay for an order</Goal>
      </Goals>
    </Actor>
    <Actor id="INSTALLER">
      <Name>Installer</Name>
      <Goals>
        <Goal id="G-SCHEDULE">Schedule and perform installations</Goal>
        <Goal id="G-UPDATE">Update appointment status</Goal>
      </Goals>
    </Actor>
    <Actor id="ADMIN">
      <Name>Admin</Name>
      <Goals>
        <Goal id="G-CATALOG">Manage catalog, rules, and media</Goal>
        <Goal id="G-PRICING">Manage pricing rules and promotions</Goal>
        <Goal id="G-REPORTING">View operational and sales reports</Goal>
      </Goals>
    </Actor>
    <Actor id="PAYMENT_GATEWAY">
      <Name>ExternalPaymentGateway</Name>
      <Goals>
        <Goal id="G-PAYMENT">Authorize and capture payments</Goal>
      </Goals>
    </Actor>
    <Actor id="NOTIFICATION_CHANNEL">
      <Name>EmailSmsPushProviders</Name>
      <Goals>
        <Goal id="G-NOTIFY">Deliver transactional and marketing messages</Goal>
      </Goals>
    </Actor>
    <Actor id="SEARCH_ENGINE">
      <Name>SearchIndex</Name>
      <Goals>
        <Goal id="G-INDEX">Enable faceted and autocomplete search</Goal>
      </Goals>
    </Actor>
  </Actors>

  <UseCases>
    <UseCase id="UC-BROWSE-SEARCH">
      <ActorRef ref="CUSTOMER"/>
      <Action>Browses and filters catalog</Action>
      <Goal>Find relevant window/door products to configure</Goal>
      <Preconditions>Catalog version is active and indexed.</Preconditions>
      <Postconditions>Matching products and facets are returned.</Postconditions>
      <MainFlow>Customer search/filter request -> search-service returns results with facets.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-search-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Search-Experience"/>
      </Links>
    </UseCase>

    <UseCase id="UC-CONFIGURE-ITEM">
      <ActorRef ref="CUSTOMER"/>
      <Action>Configures a window or door</Action>
      <Goal>Receive a valid configuration ready for pricing</Goal>
      <Preconditions>Product template is active; user provides required attributes.</Preconditions>
      <Postconditions>Configuration is validated against rules; errors reported if invalid.</Postconditions>
      <MainFlow>Customer selects template and options -> catalog-configuration-service validates -> returns normalized configuration.</MainFlow>
      <AlternateFlows>Invalid option combination -> rule violation; template not active -> not found error.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-catalog-configuration-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Config-Pricing"/>
      </Links>
    </UseCase>

    <UseCase id="UC-PRICE-PREVIEW">
      <ActorRef ref="CUSTOMER"/>
      <Action>Requests a price for a configuration</Action>
      <Goal>See price with taxes, discounts, and currency</Goal>
      <Preconditions>Configuration is valid; currency/region known.</Preconditions>
      <Postconditions>Price breakdown returned; quote cached for cart use.</Postconditions>
      <MainFlow>Validated configuration -> pricing-service computes base + options + discounts -> returns price.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-pricing-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Config-Pricing"/>
      </Links>
    </UseCase>

    <UseCase id="UC-ADD-TO-CART">
      <ActorRef ref="CUSTOMER"/>
      <Action>Adds a priced configuration to cart</Action>
      <Goal>Persist cart with selected shipping/installation options</Goal>
      <Preconditions>Authenticated session or cart token exists; configuration priced.</Preconditions>
      <Postconditions>Cart item stored with price and availability locks/holds where applicable.</Postconditions>
      <MainFlow>Customer adds item -> cart-service stores item and totals -> responds with cart summary.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-cart-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Cart-Checkout"/>
      </Links>
    </UseCase>

    <UseCase id="UC-CHECKOUT-ORDER">
      <ActorRef ref="CUSTOMER"/>
      <Action>Checks out cart and submits order</Action>
      <Goal>Create an order with payment/deposit and delivery/install preferences</Goal>
      <Preconditions>Cart exists with valid items and addresses; customer authenticated.</Preconditions>
      <Postconditions>Order created with status PENDING_PAYMENT or CONFIRMED; downstream notifications triggered.</Postconditions>
      <MainFlow>Customer provides addresses/shipping/install choices -> cart validated and totals confirmed -> order-service creates order.</MainFlow>
      <AlternateFlows>Inventory or rule check fails -> checkout blocked; payment failure -> order remains pending or cancels per policy.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-order-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Cart-Checkout"/>
      </Links>
    </UseCase>

    <UseCase id="UC-PAYMENT">
      <ActorRef ref="CUSTOMER"/>
      <Action>Pays deposit or full amount</Action>
      <Goal>Authorize and capture funds for the order</Goal>
      <Preconditions>Order exists with payable amount; supported payment method selected.</Preconditions>
      <Postconditions>Payment status updated; receipts sent; order state advanced on success.</Postconditions>
      <MainFlow>order-service requests payment -> payment gateway redirects/collects -> callback updates order/payment records.</MainFlow>
      <AlternateFlows>Authorization declined -> retry or cancel; callback missing -> reconciliation job handles.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-order-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Payment"/>
      </Links>
    </UseCase>

    <UseCase id="UC-ORDER-LIFECYCLE">
      <ActorRef ref="CUSTOMER"/>
      <ActorRef ref="INSTALLER"/>
      <Action>Tracks order production, delivery, and installation</Action>
      <Goal>Stay informed of status and manage appointments</Goal>
      <Preconditions>Order confirmed; production slots available.</Preconditions>
      <Postconditions>Statuses updated; installation appointment stored; notifications sent.</Postconditions>
      <MainFlow>order-service advances state machine -> installer selects slots -> notifications broadcast.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-order-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Order-Lifecycle"/>
      </Links>
    </UseCase>

    <UseCase id="UC-INSTALL-SLOT-SEARCH">
      <ActorRef ref="CUSTOMER"/>
      <Action>Searches available installation slots</Action>
      <Goal>Select viable installation windows for an order</Goal>
      <Preconditions>Order is eligible for scheduling; region/timezone known.</Preconditions>
      <Postconditions>Available slots returned with conflict/reservation hints.</Postconditions>
      <MainFlow>Customer requests slots -> installation-service checks availability/cache -> returns slot options.</MainFlow>
      <AlternateFlows>No slots available -> empty result; order not eligible -> validation error.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-installation-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Installation"/>
      </Links>
    </UseCase>

    <UseCase id="UC-INSTALL-BOOK">
      <ActorRef ref="CUSTOMER"/>
      <ActorRef ref="INSTALLER"/>
      <Action>Books an installation slot</Action>
      <Goal>Reserve installation time with idempotency and conflict protection</Goal>
      <Preconditions>Slot available; order in schedulable state; auth/authorization passed.</Preconditions>
      <Postconditions>Booking persisted with status SCHEDULED/CONFIRMED; order-service notified.</Postconditions>
      <MainFlow>User selects slot -> installation-service locks slot -> emits installation.scheduled -> order-service updates state.</MainFlow>
      <AlternateFlows>Slot conflict -> 409-style error; duplicate request -> idempotent replay returns existing booking.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-installation-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Installation"/>
      </Links>
    </UseCase>

    <UseCase id="UC-INSTALL-UPDATE">
      <ActorRef ref="INSTALLER"/>
      <Action>Updates installation status</Action>
      <Goal>Reflect progress for downstream notifications and reporting</Goal>
      <Preconditions>Booking exists; transition allowed.</Preconditions>
      <Postconditions>Status updated; installation.updated event emitted; order/reporting/notification services informed.</Postconditions>
      <MainFlow>Installer updates status -> installation-service validates transition -> persists -> emits event.</MainFlow>
      <AlternateFlows>Invalid transition -> rejected with reason; missing booking -> not found.</AlternateFlows>
      <Links>
        <Link ref="Technology.xml#SVC-installation-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Installation"/>
      </Links>
    </UseCase>

    <UseCase id="UC-MANAGE-CATALOG">
      <ActorRef ref="ADMIN"/>
      <Action>Creates and publishes product templates, options, and rules</Action>
      <Goal>Provide valid templates and versions for downstream services</Goal>
      <Preconditions>Admin authenticated with CATALOG_ADMIN role.</Preconditions>
      <Postconditions>Drafts stored; validations passed; versions published with events emitted.</Postconditions>
      <MainFlow>Admin drafts template/options/rules -> validates -> publishes version -> events sent to pricing/search.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-catalog-configuration-service"/>
        <Link ref="DevelopmentPlan.xml#Service-catalog-configuration-service"/>
      </Links>
    </UseCase>

    <UseCase id="UC-MANAGE-PRICING-CAMPAIGN">
      <ActorRef ref="ADMIN"/>
      <Action>Defines base price lists, discounts, and campaigns</Action>
      <Goal>Control pricing strategies per region, currency, and season</Goal>
      <Preconditions>Pricing policies configured; catalog data available.</Preconditions>
      <Postconditions>Pricing rules active; cached; reflected in quotes and carts.</Postconditions>
      <MainFlow>Admin updates price book or campaign -> pricing-service recalculates derived rules -> publishes change events.</MainFlow>
      <Links>
        <Link ref="Technology.xml#SVC-pricing-service"/>
        <Link ref="DevelopmentPlan.xml#Service-pricing-service"/>
      </Links>
    </UseCase>

    <UseCase id="UC-MANAGE-ACCOUNT">
      <ActorRef ref="CUSTOMER"/>
      <ActorRef ref="ADMIN"/>
      <Action>Manages accounts, roles, and saved configurations</Action>
      <Goal>Keep user profiles, addresses, and saved designs consistent</Goal>
      <Preconditions>User authenticated; role checks enforced.</Preconditions>
      <Postconditions>Profiles updated; saved configurations persisted; audit logged.</Postconditions>
      <Links>
        <Link ref="Technology.xml#SVC-account-service"/>
        <Link ref="DevelopmentPlan.xml#Service-account-service"/>
      </Links>
    </UseCase>

    <UseCase id="UC-MEDIA-MANAGEMENT">
      <ActorRef ref="ADMIN"/>
      <Action>Uploads and manages product media/renders/manuals</Action>
      <Goal>Serve optimized assets linked to catalog items</Goal>
      <Preconditions>Admin authenticated; storage available.</Preconditions>
      <Postconditions>Assets stored with variants; references linked to catalog items.</Postconditions>
      <Links>
        <Link ref="Technology.xml#SVC-media-service"/>
        <Link ref="DevelopmentPlan.xml#Service-media-service"/>
      </Links>
    </UseCase>

    <UseCase id="UC-NOTIFICATIONS">
      <ActorRef ref="NOTIFICATION_CHANNEL"/>
      <Action>Sends order/configuration/cart reminders</Action>
      <Goal>Keep stakeholders informed and reduce drop-off</Goal>
      <Preconditions>Trigger events emitted; user channel preferences known.</Preconditions>
      <Postconditions>Messages sent with delivery status tracked.</Postconditions>
      <Links>
        <Link ref="Technology.xml#SVC-notification-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Notifications"/>
      </Links>
    </UseCase>

    <UseCase id="UC-REPORTING-ANALYTICS">
      <ActorRef ref="ADMIN"/>
      <Action>Views operational and sales dashboards</Action>
      <Goal>Monitor conversion, product performance, and installation throughput</Goal>
      <Preconditions>Events and read models populated.</Preconditions>
      <Postconditions>Reports generated; exports available for BI.</Postconditions>
      <Links>
        <Link ref="Technology.xml#SVC-reporting-service"/>
        <Link ref="DevelopmentPlan.xml#Flow-Reporting"/>
      </Links>
    </UseCase>
  </UseCases>

  <NonFunctionalRequirements>
    <Requirement id="NFR-PERF">P95: config validation equal or less than 150ms; price preview equal or less than 200ms; checkout equal or less than 350ms.</Requirement>
    <Requirement id="NFR-AVAILABILITY">99.9% uptime for customer-facing APIs; graceful degradation for search/notifications.</Requirement>
    <Requirement id="NFR-CONSISTENCY">Catalog and pricing changes versioned and immutable once published; carts/orders idempotent.</Requirement>
    <Requirement id="NFR-SECURITY">OAuth2/OIDC JWT, role-based access, input validation, PII minimization, audit trails.</Requirement>
    <Requirement id="NFR-OBSERVABILITY">Structured JSON logs with traceId/spanId, business metrics for conversion/pricing errors, OTEL traces.</Requirement>
    <Requirement id="NFR-RESILIENCE">Timeouts, retries with jitter, circuit breakers, bulkheads on external calls.</Requirement>
  </NonFunctionalRequirements>

  <Links>
    <Link ref="Technology.xml"/>
    <Link ref="DevelopmentPlan.xml"/>
  </Links>
</RequirementsAnalysis>
