<?xml version="1.0" encoding="UTF-8"?>
<!--
  GRACE Coder Work Order: Git Workflow Execution
  Created: 2026-01-24T10:00:00+03:00
  CreatedBy: GRACE-COORDINATOR
  Purpose: Execute Git operations for completed implementations
-->
<CODER_WORK_ORDER id="CWO-20260121-03-GIT-WORKFLOW-EXECUTION" status="ISSUED">
  <Preconditions>
    <Item status="VERIFIED">CWO-20260121-01-SECURITY-SCAN-REMEDIATION implementation complete</Item>
    <Item status="VERIFIED">CWO-20260121-02-API-CONTRACTS-SCC-CLEANUP implementation complete</Item>
    <Item status="VERIFIED">Both handoffs approved in approvals.log</Item>
    <Item>Build verification pending (run mvn clean verify before commit)</Item>
  </Preconditions>

  <Scope>
    <Purpose>Execute Git workflow for two completed work packages</Purpose>
    <WorkPackages>
      <Package id="PKG-1" ref="CWO-20260121-02-API-CONTRACTS-SCC-CLEANUP">
        <Name>API Contracts SCC Cleanup</Name>
        <BranchSpec ref="BS-20260121-02-API-CONTRACTS-SCC-CLEANUP"/>
      </Package>
      <Package id="PKG-2" ref="CWO-20260121-01-SECURITY-SCAN-REMEDIATION">
        <Name>Security Scan Remediation</Name>
        <BranchSpec ref="BS-20260121-01-SECURITY-SCAN-REMEDIATION"/>
      </Package>
    </WorkPackages>
  </Scope>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CRITICAL: GIT WORKFLOW IS MANDATORY
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <MandatoryGitWorkflow>
    <Rule>You MUST execute ALL git commands specified below</Rule>
    <Rule>You MUST create branches BEFORE committing</Rule>
    <Rule>You MUST NOT commit directly to develop or main</Rule>
    <Rule>You MUST create PRs using gh pr create</Rule>
    <Rule>Report GitExecutionSteps showing exact commands executed</Rule>
  </MandatoryGitWorkflow>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PACKAGE 1: API Contracts Cleanup
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <GitExecution id="GIT-PKG-1" package="API Contracts Cleanup">
    <BranchSpec>
      <BranchName>bugfix/W1-api-contracts-scc-cleanup</BranchName>
      <BaseBranch>develop</BaseBranch>
      <PRTarget>develop</PRTarget>
      <MergeMethod>squash</MergeMethod>
    </BranchSpec>

    <FilesToStage>
      <File>api-contracts/pom.xml</File>
      <Note>Also stage deletion of api-contracts/src/test/resources/contracts/ if it existed</Note>
    </FilesToStage>

    <Commands>
      <Step order="1">
        <Command>git checkout develop</Command>
        <Command>git pull origin develop</Command>
      </Step>
      <Step order="2">
        <Command>git checkout -b bugfix/W1-api-contracts-scc-cleanup</Command>
      </Step>
      <Step order="3">
        <Command>git add api-contracts/pom.xml</Command>
        <Note>Add any other changed files for this package</Note>
      </Step>
      <Step order="4">
        <Command><![CDATA[git commit -m "[W1-INFRA] Remove Spring Cloud Contract verifier from api-contracts

- Remove spring-cloud-contract-maven-plugin (incorrect location)
- Remove spring-cloud-contract-* dependencies (test scope)
- Remove rest-assured dependency (test scope)
- Delete contracts directory (to be moved to producer services later)
- Add clearOutputDirectory=false for Windows file locking workaround

This fixes the build failure caused by verifier tests requiring
MockMVC context in a library module. Contract verification will
be implemented in producer services in a future wave.

Resolves: CODE-ISS-RPT-20260121-01
AWO: AWO-20260121-02-API-CONTRACTS-RESTASSURED

Co-Authored-By: Claude <noreply@anthropic.com>"]]></Command>
      </Step>
      <Step order="5">
        <Command>git push -u origin bugfix/W1-api-contracts-scc-cleanup</Command>
      </Step>
      <Step order="6">
        <Command><![CDATA[gh pr create --base develop --title "[W1-INFRA] Remove Spring Cloud Contract verifier from api-contracts" --body "## Summary

Remove Spring Cloud Contract verifier infrastructure from api-contracts module.

**Root Cause:** api-contracts is a library module for contract definitions only. It cannot execute Spring Cloud Contract verifier tests because:
- Verifier tests require MockMVC with actual controllers
- api-contracts has no Spring Boot runtime or controllers
- Contract verification belongs in producer services

**Solution:** Remove verifier plugin and dependencies. Contract verification will be implemented in producer services in a future wave (PHASE-02 deferred).

## Changes

- Remove spring-cloud-contract-maven-plugin from pom.xml
- Remove spring-cloud-contract-spec dependency
- Remove spring-cloud-contract-verifier dependency
- Remove spring-mock-mvc dependency
- Add clearOutputDirectory=false (Windows workaround)

## References

- AWO: AWO-20260121-02-API-CONTRACTS-RESTASSURED
- Resolves: CODE-ISS-RPT-20260121-01
- Contract: MC-api-contracts-post-fix
- Decision: DEC-API-CONTRACTS-SCC-ROLE

## Test Plan

- [x] mvn clean verify -pl api-contracts passes
- [x] Full mvn clean verify passes

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)"]]></Command>
      </Step>
    </Commands>
  </GitExecution>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PACKAGE 2: Security Scan Remediation
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <GitExecution id="GIT-PKG-2" package="Security Scan Remediation">
    <BranchSpec>
      <BranchName>bugfix/W1-security-scan-remediation</BranchName>
      <BaseBranch>develop</BaseBranch>
      <PRTarget>develop</PRTarget>
      <MergeMethod>squash</MergeMethod>
    </BranchSpec>

    <FilesToStage>
      <File>shared/shared-kernel/pom.xml</File>
      <File>shared/shared-kernel/src/main/java/com/kanokna/shared/logging/LogSanitizer.java</File>
      <File>shared/shared-kernel/src/test/java/com/kanokna/shared/logging/LogSanitizerTest.java</File>
      <File>services/pricing-service/src/main/java/com/kanokna/pricing/application/service/PriceCalculationUseCaseService.java</File>
      <File>services/account-service/src/main/java/com/kanokna/account/application/service/AddressService.java</File>
      <File>services/account-service/src/main/java/com/kanokna/account/adapters/config/SecurityConfig.java</File>
      <File>services/cart-service/src/main/java/com/kanokna/cart/application/service/CartPricingService.java</File>
      <File>services/cart-service/src/main/java/com/kanokna/cart/adapters/config/SecurityConfig.java</File>
      <File>services/search-service/src/main/java/com/kanokna/search/adapters/out/elasticsearch/ElasticsearchSearchRepository.java</File>
      <File>services/search-service/src/main/java/com/kanokna/search/adapters/config/SecurityConfig.java</File>
      <File>services/search-service/src/main/java/com/kanokna/search/adapters/config/JacksonConfig.java</File>
      <File>services/catalog-configuration-service/src/main/java/com/kanokna/catalog/domain/service/BomResolutionService.java</File>
      <File>services/catalog-configuration-service/src/main/java/com/kanokna/catalog/adapters/config/SecurityConfig.java</File>
      <File>services/pricing-service/src/main/java/com/kanokna/pricing/adapters/config/SecurityConfig.java</File>
      <File>gateway/src/main/java/com/kanokna/gateway/config/SecurityConfig.java</File>
      <File>config-server/src/main/java/com/kanokna/config_server/config/SecurityConfig.java</File>
      <File>.github/codeql-config.yml</File>
      <File>.github/workflows/codeql.yml</File>
    </FilesToStage>

    <Commands>
      <Step order="1">
        <Command>git checkout develop</Command>
        <Command>git pull origin develop</Command>
      </Step>
      <Step order="2">
        <Command>git checkout -b bugfix/W1-security-scan-remediation</Command>
      </Step>
      <Step order="3">
        <Command>git add -A</Command>
        <Note>Stage all security remediation changes</Note>
      </Step>
      <Step order="4">
        <Command><![CDATA[git commit -m "[W1-SECURITY-SCAN] Remediate GitHub CodeQL security alerts

HIGH SEVERITY FIXES:
- Add LogSanitizer utility to shared-kernel (OWASP Encoder)
- Fix log injection in PriceCalculationUseCaseService
- Add CSRF explanation comments to all SecurityConfig files

CODE QUALITY FIXES:
- Fix null dereference in AddressService.java
- Fix missing switch case in ElasticsearchSearchRepository.java
- Fix unread variable in CartPricingService.java
- Fix uncaught NumberFormatException in BomResolutionService.java
- Fix deprecated API call in JacksonConfig.java

INFRASTRUCTURE:
- Create .github/codeql-config.yml with exclusions
- Update codeql.yml to reference new config

Decisions:
- DEC-SEC-CSRF-STATELESS: CSRF disabled for stateless JWT APIs
- DEC-SEC-LOG-SANITIZATION: OWASP Encoder for log sanitization
- DEC-SEC-CODEQL-EXCLUSIONS: Exclude generated protobuf sources

Handoff: Handoff-20260121-01-W1-SECURITY-SCAN-REMEDIATION
CWO: CWO-20260121-01-SECURITY-SCAN-REMEDIATION

Co-Authored-By: Claude <noreply@anthropic.com>"]]></Command>
      </Step>
      <Step order="5">
        <Command>git push -u origin bugfix/W1-security-scan-remediation</Command>
      </Step>
      <Step order="6">
        <Command><![CDATA[gh pr create --base develop --title "[W1-SECURITY-SCAN] Remediate GitHub CodeQL security alerts" --body "## Summary

Remediate HIGH severity security alerts and code quality issues from GitHub CodeQL analysis.

## HIGH Severity Fixes

### Log Injection (CRITICAL)
- Added LogSanitizer utility to shared-kernel using OWASP Encoder
- Updated PriceCalculationUseCaseService to sanitize user input before logging

### CSRF Documentation
- Added explanatory comments to all SecurityConfig files explaining why CSRF is intentionally disabled (stateless JWT APIs)

## Code Quality Fixes

- **AddressService.java:186** - Fix null dereference
- **ElasticsearchSearchRepository.java:316** - Add missing switch case
- **CartPricingService.java:152** - Remove unread variable
- **BomResolutionService.java:131,134,136** - Handle NumberFormatException
- **JacksonConfig.java:30** - Replace deprecated API

## Infrastructure

- Created .github/codeql-config.yml with:
  - Exclusions for generated protobuf sources
  - Suppression of CSRF rule (documented decision)
- Updated codeql.yml workflow to use new config

## References

- Handoff: Handoff-20260121-01-W1-SECURITY-SCAN-REMEDIATION
- Decisions: DEC-SEC-CSRF-STATELESS, DEC-SEC-LOG-SANITIZATION, DEC-SEC-CODEQL-EXCLUSIONS
- Contracts: MC-shared-kernel-logging-LogSanitizer

## Test Plan

- [x] LogSanitizerTest passes all 4 test cases
- [x] mvn clean verify succeeds on all modules
- [ ] CodeQL workflow runs with new config
- [ ] HIGH severity alerts resolved in GitHub Security tab

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)"]]></Command>
      </Step>
    </Commands>
  </GitExecution>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EXECUTION ORDER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <ExecutionOrder>
    <Note>Execute packages in order. PKG-1 first, then PKG-2.</Note>
    <Step order="1">Run mvn clean verify to confirm build passes</Step>
    <Step order="2">Execute GIT-PKG-1 (api-contracts cleanup)</Step>
    <Step order="3">Execute GIT-PKG-2 (security scan remediation)</Step>
    <Step order="4">Report PR links for both packages</Step>
  </ExecutionOrder>

  <RequiredOutputs>
    <Item>Build verification result (mvn clean verify)</Item>
    <Item>GitExecutionSteps for PKG-1 with exact commands executed</Item>
    <Item>PR link for PKG-1</Item>
    <Item>GitExecutionSteps for PKG-2 with exact commands executed</Item>
    <Item>PR link for PKG-2</Item>
  </RequiredOutputs>
</CODER_WORK_ORDER>
