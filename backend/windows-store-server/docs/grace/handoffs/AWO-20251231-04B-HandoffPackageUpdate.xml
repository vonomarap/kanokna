<?xml version="1.0" encoding="UTF-8"?>
<!--
  GRACE Architect Work Order (OPTION-B)
  ID: AWO-20251231-04B
  Purpose: Update handoff to use pricing_service package naming
  Blocking: YES (GRACE-CODER implementation blocked)
  Created: 2025-12-31T15:45:00+03:00
  Issued by: GRACE-COORDINATOR
  User Preference: Maintain pricing_service naming convention
-->
<ARCHITECT_WORK_ORDER id="AWO-20251231-04B" status="PROPOSED">

  <Task>
    <WaveRef>W1</WaveRef>
    <TaskRef>W1-T3,W1-T4</TaskRef>
    <UserRequest>Update handoff to use pricing_service package naming (maintain DevelopmentPlan.xml pattern)</UserRequest>
    <PrimaryGoal>
      Update Handoff-20251231-02 to use com.kanokna.pricing_service.* package naming
      throughout all file paths, configurations, and embedded contracts to align with
      DevelopmentPlan.xml canonical specification.
    </PrimaryGoal>
    <Urgency>BLOCKING</Urgency>
    <Context>
      User has chosen to maintain pricing_service naming convention (with underscore)
      as specified in DevelopmentPlan.xml. Handoff must be updated to match, requiring
      new version and re-approval.
    </Context>
  </Task>

  <KnownArtifacts>
    <Artifact name="DevelopmentPlan.xml" provided="yes" version="1.3.0" authoritative="YES"/>
    <Artifact name="Handoff-20251231-02-W1-T3-T4-PricingService.xml" provided="yes" status="APPROVED (will be superseded)"/>
  </KnownArtifacts>

  <BlockingIssues>
    <Issue ref="ISS-20251231-02-PKG-001" severity="BLOCKING">
      Current handoff uses com.kanokna.pricing.* but DevelopmentPlan.xml (canonical)
      specifies com.kanokna.pricing_service.*. User wants to keep DevelopmentPlan.xml
      pattern, so handoff must be updated.
    </Issue>
  </BlockingIssues>

  <Scope>
    <HandoffUpdates>
      <File>Handoff-20251231-02-W1-T3-T4-PricingService.xml</File>
      <NewVersion>Handoff-20251231-02-v2</NewVersion>
      <ChangePattern>com/kanokna/pricing → com/kanokna/pricing_service (all occurrences)</ChangePattern>
    </HandoffUpdates>
  </Scope>

  <RequiredOutputs>

    <HandoffUpdates>
      <NewHandoffFile>Handoff-20251231-02-v2-W1-T3-T4-PricingService.xml</NewHandoffFile>

      <HeaderUpdates>
        <Change field="id">Handoff-20251231-02 → Handoff-20251231-02-v2</Change>
        <Change field="status">APPROVED → PROPOSED</Change>
        <Change field="created">Update to current timestamp</Change>
      </HeaderUpdates>

      <ContentUpdates>
        <Section name="FilesToCreate" lines="143-521">
          <Change>Update ALL ~80 file paths</Change>
          <Pattern>
            FROM: pricing-service/src/main/java/com/kanokna/pricing/domain/model/...
            TO:   pricing-service/src/main/java/com/kanokna/pricing_service/domain/model/...

            FROM: pricing-service/src/main/java/com/kanokna/pricing/application/port/in/...
            TO:   pricing-service/src/main/java/com/kanokna/pricing_service/application/port/in/...

            FROM: pricing-service/src/main/java/com/kanokna/pricing/adapters/in/web/...
            TO:   pricing-service/src/main/java/com/kanokna/pricing_service/adapters/in/web/...

            (Apply to all file paths consistently)
          </Pattern>
          <EstimatedOccurrences>~80 file paths</EstimatedOccurrences>
        </Section>

        <Section name="SemanticContractsAndAnchors" lines="526-898">
          <Change>Update EmbedInFile paths in MODULE_CONTRACT and FUNCTION_CONTRACTs</Change>
          <Pattern>
            FROM: &lt;EmbedInFile&gt;pricing-service/src/main/java/com/kanokna/pricing/domain/service/PriceCalculationService.java&lt;/EmbedInFile&gt;
            TO:   &lt;EmbedInFile&gt;pricing-service/src/main/java/com/kanokna/pricing_service/domain/service/PriceCalculationService.java&lt;/EmbedInFile&gt;

            (Apply to all 5 contract EmbedInFile declarations)
          </Pattern>
          <AffectedContracts>
            <Contract id="MC-pricing-service-domain-PriceCalculation" line="532"/>
            <Contract id="FC-pricing-service-UC-PRICING-QUOTE-calculateQuote" line="639"/>
            <Contract id="FC-pricing-service-UC-PRICING-QUOTE-validatePromoCode" line="720"/>
            <Contract id="FC-pricing-service-UC-PRICING-ADMIN-MANAGE-createPriceBook" line="769"/>
            <Contract id="FC-pricing-service-UC-PRICING-ADMIN-MANAGE-publishPriceBook" line="816"/>
          </AffectedContracts>
        </Section>

        <Section name="ImplementationSpecifications - application.yml" line="1059">
          <Change>Update logging package configuration</Change>
          <Pattern>
            FROM: com.kanokna.pricing: DEBUG
            TO:   com.kanokna.pricing_service: DEBUG
          </Pattern>
        </Section>

        <Section name="Artifacts" line="1277">
          <NoChange>Technology.xml version remains 1.2.0 (no changes to Technology.xml)</NoChange>
          <NoChange>DevelopmentPlan.xml version remains 1.3.0 (DevelopmentPlan.xml is correct)</NoChange>
        </Section>
      </ContentUpdates>

      <ValidationBeforeDelivery>
        <Item>Search entire handoff for "com.kanokna.pricing." (with dot, not underscore)</Item>
        <Item>Verify NO occurrences remain except in decision descriptions/rationale</Item>
        <Item>Verify ALL file paths use com/kanokna/pricing_service/</Item>
        <Item>Verify application.yml uses com.kanokna.pricing_service: DEBUG</Item>
        <Item>Verify all EmbedInFile paths updated consistently</Item>
      </ValidationBeforeDelivery>
    </HandoffUpdates>

    <DecisionDocumentation>
      <Decision id="DEC-PACKAGE-NAMING-CONVENTION" status="APPROVED">
        <Title>Service Package Naming Convention</Title>
        <Selected>Full service names with underscores (com.kanokna.pricing_service.*)</Selected>
        <Rationale>
          Maintain consistency with catalog-configuration-service existing pattern.
          Direct mapping from service name to package name eliminates ambiguity.
          User preference to maintain existing DevelopmentPlan.xml specification.
        </Rationale>
        <Destination>Add to Technology.xml Decisions section OR DevelopmentPlan.xml Assumptions</Destination>
      </Decision>
    </DecisionDocumentation>

  </RequiredOutputs>

  <AcceptanceCriteria>
    <Item>New handoff file created: Handoff-20251231-02-v2-W1-T3-T4-PricingService.xml</Item>
    <Item>Handoff status set to PROPOSED (awaiting new approval)</Item>
    <Item>All ~80 file paths updated to use com/kanokna/pricing_service/</Item>
    <Item>All 5 EmbedInFile paths in contracts updated consistently</Item>
    <Item>application.yml logging config updated to com.kanokna.pricing_service: DEBUG</Item>
    <Item>No occurrences of "com.kanokna.pricing." (without underscore) in file paths or configs</Item>
    <Item>DevelopmentPlan.xml remains unchanged (already correct at v1.3.0)</Item>
    <Item>Package naming decision documented in Technology.xml or DevelopmentPlan.xml</Item>
  </AcceptanceCriteria>

  <PostDeliverySteps>
    <Step order="1">Return updated handoff to human</Step>
    <Step order="2">Human submits to GRACE-COORDINATOR: "Handoff-20251231-02-v2: Updated to pricing_service pattern"</Step>
    <Step order="3">GRACE-COORDINATOR re-runs Blueprint Validation Gates</Step>
    <Step order="4">If PASS, GRACE-COORDINATOR issues approval instruction</Step>
    <Step order="5">Human adds approval to approvals.log</Step>
    <Step order="6">GRACE-COORDINATOR issues updated CODER_WORK_ORDER</Step>
  </PostDeliverySteps>

  <EstimatedComplexity>MEDIUM (bulk find-replace across ~80+ occurrences; requires careful validation)</EstimatedComplexity>

  <ImportantNotes>
    <Note>This creates a NEW handoff version; original Handoff-20251231-02 remains approved but superseded</Note>
    <Note>New approval required for Handoff-20251231-02-v2</Note>
    <Note>DevelopmentPlan.xml does NOT change (it is already correct)</Note>
    <Note>This choice maintains consistency with catalog-configuration-service pattern</Note>
  </ImportantNotes>

  <References>
    <IssueReport>docs/grace/reports/BlueprintIssueReport-20251231-Handoff-02-PKG.xml</IssueReport>
    <OriginalHandoff>docs/grace/handoffs/Handoff-20251231-02-W1-T3-T4-PricingService.xml</OriginalHandoff>
    <DevelopmentPlan>docs/grace/DevelopmentPlan.xml (v1.3.0 - authoritative for package naming)</DevelopmentPlan>
  </References>

</ARCHITECT_WORK_ORDER>
