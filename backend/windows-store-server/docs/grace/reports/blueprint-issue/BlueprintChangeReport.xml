<?xml version="1.0" encoding="UTF-8"?>
<!--
  GRACE Canonical Artifact: BlueprintChangeReport
  Purpose: Document open decisions, blueprint issues, and change tracking for requirements update
  Version: 1.0.0
  Date: 2026-01-02
  Related Change Request: new-business-requirements.txt
-->
<BlueprintChangeReport version="1.0.0">
  <Metadata>
    <CreatedDate>2026-01-02</CreatedDate>
    <Author>GRACE-ARCHITECT</Author>
    <SourceDocument>new-business-requirements.txt</SourceDocument>
    <AffectedArtifacts>
      <Artifact id="RA" version="1.0.0 → 1.1.0">RequirementsAnalysis.xml</Artifact>
      <Artifact id="DP" version="1.3.0 → 1.4.0">DevelopmentPlan.xml</Artifact>
    </AffectedArtifacts>
  </Metadata>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SECTION 1: CHANGE SUMMARY
       ═══════════════════════════════════════════════════════════════════════════ -->
  <ChangeSummary>
    <Overview>
      Business requirements update introducing B2C/B2B customer journeys, field operations,
      status model with audit trail, and phased development plan with acceptance gates.
    </Overview>

    <RequirementsAnalysisChanges>
      <Change type="ADD" category="Actors">
        10 new actors: B2C Customer, B2B Dealer, Sales Manager, Measurement Technician,
        Installer, Logistics Coordinator, Warehouse Staff, CRM/ERP System, CAD System, Logistics
        System
      </Change>
      <Change type="ADD" category="UseCases">
        15 new use cases across MUST/SHOULD/LATER priorities covering CPQ, measurement,
        ordering, tracking, B2B workflows, field operations, and support
      </Change>
      <Change type="ADD" category="StatusModel">
        Comprehensive status model with Lead/Deal, Order, and Service domains;
        immutable audit trail requirement for all status transitions
      </Change>
      <Change type="ADD" category="DomainGlossary">
        17 domain entities defined with bounded context ownership
      </Change>
      <Change type="ADD" category="Integrations">
        5 integration requirements: CRM, CAD/CPQ, ERP, Logistics, Payments
      </Change>
      <Change type="ADD" category="NFRs">
        Extended NFRs for audit trail, status tracking, B2B scalability
      </Change>
    </RequirementsAnalysisChanges>

    <DevelopmentPlanChanges>
      <Change type="ADD" category="Phases">
        5 development phases (0-4) with deliverables and acceptance gates
      </Change>
      <Change type="ADD" category="Services">
        5 new services: workflow-service, field-ops-service, document-service,
        billing-service, support-service
      </Change>
      <Change type="ADD" category="Flows">
        6 new flows: B2C-CPQ, Measurement-Visit, Checkout-Payment, Order-Fulfillment,
        B2B-Project-Order, Service-Request
      </Change>
      <Change type="ADD" category="StateMachine">
        Extended order state machine with PAID lock and fulfillment states
      </Change>
      <Change type="ADD" category="Integrations">
        5 integration contracts with external systems
      </Change>
      <Change type="ADD" category="BlockAnchors">
        New block anchors for order locking, audit trail, measurement, installation
      </Change>
    </DevelopmentPlanChanges>
  </ChangeSummary>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SECTION 2: OPEN DECISIONS (Requiring Resolution)
       ═══════════════════════════════════════════════════════════════════════════ -->
  <OpenDecisions>

    <!-- RESOLVED DECISION -->
    <Decision id="DEC-RESOLVED-STATUS-SOT" priority="MEDIUM" phase="PHASE-2" status="RESOLVED">
      <Title>Status Source of Truth</Title>
      <Description>
        Determine which system is the source of truth for production and logistics statuses.
      </Description>
      <Resolution resolvedDate="2026-01-05">
        HYBRID OWNERSHIP: Define field-level ownership with clear domain boundaries.
        - Platform owns: customer-facing status, order status, payment status
        - ERP owns: manufacturing/production status
        - Logistics system owns: delivery/shipment status
        Reconciliation via event-driven sync with platform as aggregation layer for customer view.
      </Resolution>
      <Impact>
        Affects Order-Fulfillment flow, INT-ERP and INT-LOGISTICS contracts,
        audit trail implementation, and conflict resolution strategy.
      </Impact>
      <Stakeholders>
        <Stakeholder role="Product Owner">Decision authority</Stakeholder>
        <Stakeholder role="Integration Lead">Technical assessment</Stakeholder>
        <Stakeholder role="ERP Team">ERP capabilities</Stakeholder>
      </Stakeholders>
    </Decision>

    <!-- HIGH PRIORITY DECISIONS -->
    <Decision id="DEC-OPEN-CAD-FORMAT" priority="HIGH" phase="PHASE-1">
      <Title>CAD Integration API Format and SLA</Title>
      <Description>
        Define the API format, data exchange format, and SLA for CAD system integration
        used in configuration validation and drawing generation.
      </Description>
      <Impact>
        Affects UC-B2C-CPQ-01, UC-B2B-CPQ-01, and INT-CAD contract implementation.
      </Impact>
      <Options>
        <Option id="A" label="REST + JSON">Standard REST API with JSON payloads</Option>
        <Option id="B" label="gRPC + Protobuf">High-performance binary protocol</Option>
        <Option id="C" label="File-based + Events">Upload files, receive async events</Option>
      </Options>
      <Recommendation>Option A for MVP, migrate to B if latency becomes issue</Recommendation>
      <Stakeholders>
        <Stakeholder role="CAD Team">Integration capabilities</Stakeholder>
        <Stakeholder role="Backend Lead">Implementation</Stakeholder>
      </Stakeholders>
      <DueDate>Before PHASE-1 CAD integration task</DueDate>
    </Decision>

    <Decision id="DEC-OPEN-ESIGN" priority="HIGH" phase="PHASE-3">
      <Title>E-Signing Legal Level</Title>
      <Description>
        Determine the legal level of electronic signatures required for contract acceptance
        in UC-B2C-ORDER-01 and UC-B2B-CPQ-01.
      </Description>
      <Impact>
        Affects contract acceptance flow, document-service implementation,
        and choice of e-signature provider integration.
      </Impact>
      <Options>
        <Option id="A" label="Simple E-Signature">
          Click-to-accept with audit trail. Sufficient for most B2C.
        </Option>
        <Option id="B" label="Advanced E-Signature (AES)">
          Uniquely linked to signatory, capable of identifying signatory.
          Required for higher-value contracts.
        </Option>
        <Option id="C" label="Qualified E-Signature (QES)">
          Highest legal standing, equivalent to handwritten.
          Required for specific regulated transactions.
        </Option>
      </Options>
      <Recommendation>Option A for B2C, Option B for B2B high-value orders</Recommendation>
      <Stakeholders>
        <Stakeholder role="Legal">Compliance requirements</Stakeholder>
        <Stakeholder role="Product Owner">Business requirements</Stakeholder>
      </Stakeholders>
      <DueDate>Before PHASE-3 contract implementation</DueDate>
    </Decision>

    <!-- MEDIUM PRIORITY DECISIONS -->
    <Decision id="DEC-OPEN-CPQ-RULES" priority="MEDIUM" phase="PHASE-1">
      <Title>CPQ Rules and Options Governance</Title>
      <Description>
        Define governance model for CPQ configuration rules, pricing rules,
        and product option management.
      </Description>
      <Impact>
        Affects pricing-service, catalog-service, and admin interfaces.
      </Impact>
      <Options>
        <Option id="A" label="Code-Driven">
          Rules defined in code, versioned with releases.
          Stable but requires deployment for changes.
        </Option>
        <Option id="B" label="Database-Driven">
          Rules stored in database, managed via admin UI.
          Flexible but requires validation and versioning.
        </Option>
        <Option id="C" label="External Rules Engine">
          Use Drools or similar for rule management.
          Most flexible but adds complexity.
        </Option>
      </Options>
      <Recommendation>Option B with versioning and approval workflow</Recommendation>
      <Stakeholders>
        <Stakeholder role="Product Manager">Rule management needs</Stakeholder>
        <Stakeholder role="Backend Lead">Implementation complexity</Stakeholder>
      </Stakeholders>
      <DueDate>Before PHASE-1 pricing rules implementation</DueDate>
    </Decision>

    <Decision id="DEC-OPEN-NOTIF-CHANNELS" priority="MEDIUM" phase="PHASE-2">
      <Title>Notification Channels, Templates, and Events</Title>
      <Description>
        Define supported notification channels (email, SMS, push, in-app),
        template management approach, and triggering event catalog.
      </Description>
      <Impact>
        Affects UC-B2C-TRACK-01, notification-service design, and user preferences.
      </Impact>
      <Options>
        <Option id="A" label="Email Only MVP">
          Start with email only, add channels later.
          Simplest but limited reach.
        </Option>
        <Option id="B" label="Multi-Channel MVP">
          Email + SMS from start with channel preferences.
          More complex but better UX.
        </Option>
        <Option id="C" label="Full Omnichannel">
          All channels including push and in-app from start.
          Best UX but highest implementation cost.
        </Option>
      </Options>
      <Recommendation>Option B for MVP (email + SMS for critical events)</Recommendation>
      <Stakeholders>
        <Stakeholder role="Product Owner">Channel priorities</Stakeholder>
        <Stakeholder role="Marketing">Template ownership</Stakeholder>
        <Stakeholder role="Backend Lead">Implementation</Stakeholder>
      </Stakeholders>
      <DueDate>Before PHASE-2 notification implementation</DueDate>
    </Decision>

  </OpenDecisions>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SECTION 3: BLUEPRINT ISSUES (Requiring Clarification)
       ═══════════════════════════════════════════════════════════════════════════ -->
  <BlueprintIssues>

    <Issue id="BP-ISSUE-001" severity="HIGH" status="RESOLVED">
      <Title>Field Operations Offline Capability</Title>
      <Description>
        UC-FIELD-MEASURE-01 and UC-FIELD-INSTALL-01 may require offline capability
        for field technicians in areas with poor connectivity. This affects
        field-ops-service architecture significantly.
      </Description>
      <AffectedArtifacts>
        <Artifact>DevelopmentPlan.xml - field-ops-service</Artifact>
        <Artifact>RequirementsAnalysis.xml - UC-FIELD-*</Artifact>
      </AffectedArtifacts>
      <Resolution resolvedDate="2026-01-05">
        APPROVED: Add NFR for offline capability with the following strategy:
        - Optimistic locking with version vectors for conflict detection
        - Timestamp-based auto-resolution for non-conflicting changes
        - Manual review queue for conflicting field updates
        - Sync on reconnect with retry mechanism
        Action: Update RequirementsAnalysis.xml NFR-FIELD-OFFLINE and DevelopmentPlan.xml field-ops-service architecture.
      </Resolution>
    </Issue>

    <Issue id="BP-ISSUE-002" severity="MEDIUM" status="RESOLVED">
      <Title>B2B Dealer Pricing Visibility</Title>
      <Description>
        UC-B2B-CPQ-01 mentions "dealer rules" but does not specify whether
        dealers see their margin or only final customer price.
      </Description>
      <AffectedArtifacts>
        <Artifact>RequirementsAnalysis.xml - UC-B2B-CPQ-01</Artifact>
        <Artifact>DevelopmentPlan.xml - pricing-service</Artifact>
      </AffectedArtifacts>
      <Resolution resolvedDate="2026-01-05">
        APPROVED: Define dealer pricing model with the following structure:
        - Dealers see: Base cost price + their margin percentage + final customer price
        - Margin breakdown visible only to authenticated dealer users (role-based)
        - Customer-facing quotes show only final price
        Action: Add DealerPriceView entity to domain glossary and update UC-B2B-CPQ-01 acceptance criteria.
      </Resolution>
    </Issue>

    <Issue id="BP-ISSUE-003" severity="MEDIUM" status="RESOLVED">
      <Title>Measurement Update Impact on Quote</Title>
      <Description>
        UC-B2C-ORDER-01 mentions "confirm configuration (after measurement update)"
        but doesn't specify what happens if actual measurements differ significantly
        from customer-provided estimates.
      </Description>
      <AffectedArtifacts>
        <Artifact>RequirementsAnalysis.xml - UC-B2C-ORDER-01</Artifact>
        <Artifact>DevelopmentPlan.xml - Flow-Measurement-Visit</Artifact>
      </AffectedArtifacts>
      <Resolution resolvedDate="2026-01-05">
        APPROVED: Threshold-based re-approval flow with the following rules:
        - Price variance &lt;= 5%: Auto-accept with notification to customer
        - Price variance 5-10%: Require customer confirmation via email/SMS link
        - Price variance &gt; 10%: Generate new quote, require full re-approval flow
        - Customer can always request manual review regardless of threshold
        Action: Update UC-B2C-ORDER-01 with measurement variance handling and Flow-Measurement-Visit with re-quote branch.
      </Resolution>
    </Issue>

    <Issue id="BP-ISSUE-004" severity="LOW" status="RESOLVED">
      <Title>Proof of Delivery Document Type</Title>
      <Description>
        UC-DELIVERY-TRACK-01 mentions "proof of delivery" but doesn't specify
        the acceptable formats (photo, signature, both).
      </Description>
      <AffectedArtifacts>
        <Artifact>RequirementsAnalysis.xml - UC-DELIVERY-TRACK-01</Artifact>
        <Artifact>DevelopmentPlan.xml - INT-LOGISTICS</Artifact>
      </AffectedArtifacts>
      <Resolution resolvedDate="2026-01-05">
        APPROVED: Proof of delivery requires BOTH photo + digital signature:
        - Photo: GPS-tagged image of delivered goods at customer location
        - Digital signature: Customer signature capture on delivery device
        - Optional: Customer confirmation notification via email/SMS within 24h
        - Fallback: If customer unavailable, neighbor delivery with photo + neighbor signature + note
        Action: Update UC-DELIVERY-TRACK-01 acceptance criteria and INT-LOGISTICS contract with POD data structure.
      </Resolution>
    </Issue>

  </BlueprintIssues>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SECTION 4: ASSUMPTIONS AND CONSTRAINTS
       ═══════════════════════════════════════════════════════════════════════════ -->
  <AssumptionsAndConstraints>

    <Assumption id="ASSUM-001" status="ACTIVE">
      <Description>
        Existing architecture (Technology.xml) remains unchanged.
        New services follow established patterns (DDD, Hexagonal, gRPC, Kafka).
      </Description>
      <Validation>Confirmed in change request: "Do NOT introduce new architecture/tech"</Validation>
    </Assumption>

    <Assumption id="ASSUM-002" status="ACTIVE">
      <Description>
        Payment processing uses external gateway with PCI compliance on provider side.
        Platform handles tokenized payment references only.
      </Description>
      <Validation>Stated in requirements: "PCI on provider side; secure token/webhook handling"</Validation>
    </Assumption>

    <Assumption id="ASSUM-003" status="ACTIVE">
      <Description>
        Status model naming is consistent between customer portal and CRM interfaces.
        Single source of status definitions managed in platform.
      </Description>
      <Validation>Required by: "naming matches customer portal + CRM"</Validation>
    </Assumption>

    <Assumption id="ASSUM-004" status="VALIDATED">
      <Description>
        ERP and Logistics systems support webhook-based event notifications
        for status updates (production complete, shipped, delivered).
      </Description>
      <Validation validatedDate="2026-01-05">
        Confirmed by ERP/Logistics teams. Webhook endpoints available for:
        - Production status changes (ERP)
        - Shipment/delivery status changes (Logistics)
        Event payloads will include order reference, timestamp, and status details.
      </Validation>
    </Assumption>

    <Constraint id="CONST-001">
      <Description>
        All status changes must be audited with: timestamp, actor/system,
        source (manual/integration), correlation/order ID.
      </Description>
      <Source>Explicit requirement in change request</Source>
    </Constraint>

    <Constraint id="CONST-002">
      <Description>
        Orders in PAID status cannot be modified (immutable lock).
        Changes require new order or formal amendment process.
      </Description>
      <Source>Implied by "post-payment order locked" in UC-B2C-ORDER-01</Source>
    </Constraint>

  </AssumptionsAndConstraints>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SECTION 5: NEXT STEPS AND ACTION ITEMS
       ═══════════════════════════════════════════════════════════════════════════ -->
  <NextSteps>

    <!-- COMPLETED ACTIONS -->
    <ActionItem id="ACTION-001" priority="CRITICAL" owner="Architecture Lead" status="COMPLETED">
      <Description>
        Schedule decision meeting for DEC-OPEN-STATUS-SOT (Status Source of Truth).
      </Description>
      <CompletedDate>2026-01-05</CompletedDate>
      <Outcome>Resolved: Hybrid Ownership model selected with clear domain boundaries.</Outcome>
    </ActionItem>

    <ActionItem id="ACTION-005" priority="MEDIUM" owner="Product Owner" status="COMPLETED">
      <Description>
        Review and respond to Blueprint Issues BP-ISSUE-001 through BP-ISSUE-004.
      </Description>
      <CompletedDate>2026-01-05</CompletedDate>
      <Outcome>All 4 blueprint issues resolved with proposed resolutions approved.</Outcome>
    </ActionItem>

    <ActionItem id="ACTION-006" priority="MEDIUM" owner="Backend Lead" status="COMPLETED">
      <Description>
        Validate ASSUM-004 (ERP/Logistics webhook support) with respective teams.
      </Description>
      <CompletedDate>2026-01-05</CompletedDate>
      <Outcome>Validated: ERP and Logistics teams confirmed webhook support available.</Outcome>
    </ActionItem>

    <!-- PENDING ACTIONS -->
    <ActionItem id="ACTION-002" priority="HIGH" owner="Integration Lead" status="PENDING">
      <Description>
        Confirm CAD system integration capabilities and preferred API format
        to resolve DEC-OPEN-CAD-FORMAT.
      </Description>
      <DueDate>PHASE-1 Week 2</DueDate>
    </ActionItem>

    <ActionItem id="ACTION-003" priority="HIGH" owner="Product Owner" status="PENDING">
      <Description>
        Review and approve open decisions DEC-OPEN-CPQ-RULES and DEC-OPEN-NOTIF-CHANNELS.
      </Description>
      <DueDate>PHASE-1 completion</DueDate>
    </ActionItem>

    <ActionItem id="ACTION-004" priority="MEDIUM" owner="Legal" status="PENDING">
      <Description>
        Provide guidance on e-signature requirements to resolve DEC-OPEN-ESIGN.
      </Description>
      <DueDate>Before PHASE-3 kickoff</DueDate>
    </ActionItem>

    <!-- NEW ACTIONS FROM RESOLVED ISSUES -->
    <ActionItem id="ACTION-007" priority="HIGH" owner="Backend Lead" status="PENDING">
      <Description>
        Update RequirementsAnalysis.xml with NFR-FIELD-OFFLINE for offline capability
        and DevelopmentPlan.xml field-ops-service architecture per BP-ISSUE-001 resolution.
      </Description>
      <DueDate>Before PHASE-2 kickoff</DueDate>
    </ActionItem>

    <ActionItem id="ACTION-008" priority="MEDIUM" owner="Backend Lead" status="PENDING">
      <Description>
        Add DealerPriceView entity to domain glossary and update UC-B2B-CPQ-01
        acceptance criteria per BP-ISSUE-002 resolution.
      </Description>
      <DueDate>Before PHASE-1 B2B implementation</DueDate>
    </ActionItem>

    <ActionItem id="ACTION-009" priority="MEDIUM" owner="Backend Lead" status="PENDING">
      <Description>
        Update UC-B2C-ORDER-01 with measurement variance handling (5%/10% thresholds)
        and Flow-Measurement-Visit with re-quote branch per BP-ISSUE-003 resolution.
      </Description>
      <DueDate>Before PHASE-2 measurement flow implementation</DueDate>
    </ActionItem>

    <ActionItem id="ACTION-010" priority="LOW" owner="Backend Lead" status="PENDING">
      <Description>
        Update UC-DELIVERY-TRACK-01 acceptance criteria and INT-LOGISTICS contract
        with POD (photo + signature) data structure per BP-ISSUE-004 resolution.
      </Description>
      <DueDate>Before PHASE-4 logistics implementation</DueDate>
    </ActionItem>

  </NextSteps>

</BlueprintChangeReport>