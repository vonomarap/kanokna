# ============================================================================
# Media Service Configuration
# ============================================================================
# Manages media assets (product images, renders, manuals). Stores metadata
# in database, actual files in S3-compatible object storage.
#
# Links:
#   - DevelopmentPlan.xml#DP-SVC-media-service
#   - RequirementsAnalysis.xml#UC-MEDIA-SERVE
#   - Technology.xml#TECH-s3-compatible
# ============================================================================

server:
  port: 8087

grpc:
  server:
    port: 9087

spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:media}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    schemas: media

  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 100MB

# -----------------------------------------------------------------------------
# S3-Compatible Object Storage
# -----------------------------------------------------------------------------
storage:
  s3:
    endpoint: ${S3_ENDPOINT:http://localhost:9000}
    access-key: ${S3_ACCESS_KEY:minioadmin}
    secret-key: ${S3_SECRET_KEY:minioadmin}
    region: ${S3_REGION:us-east-1}
    bucket: ${S3_BUCKET:kanokna-media}
    # Path style access for MinIO compatibility
    path-style-access: true

  # Presigned URL settings
  presigned-url:
    upload-expiration-minutes: 15
    download-expiration-minutes: 60

  # CDN configuration (production)
  cdn:
    enabled: ${CDN_ENABLED:false}
    base-url: ${CDN_BASE_URL:}

# -----------------------------------------------------------------------------
# Media Domain Configuration
# -----------------------------------------------------------------------------
media:
  # Supported file types
  allowed-types:
    images:
      - image/jpeg
      - image/png
      - image/webp
      - image/gif
    documents:
      - application/pdf
    max-size-mb: 50

  # Image variants generation
  variants:
    enabled: true
    definitions:
      thumbnail:
        width: 150
        height: 150
        quality: 80
      small:
        width: 400
        height: 400
        quality: 85
      medium:
        width: 800
        height: 800
        quality: 85
      large:
        width: 1600
        height: 1600
        quality: 90

  # Garbage collection for orphaned assets
  garbage-collection:
    enabled: true
    orphan-threshold-days: 30
    cron: "0 0 3 * * *"  # 3 AM daily

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
logging:
  level:
    com.kanokna.media_service.domain: DEBUG
    com.kanokna.media_service.application: DEBUG
    software.amazon.awssdk: INFO
