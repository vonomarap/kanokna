# ============================================================================
# Catalog Configuration Service
# ============================================================================
server:
  port: 8081

grpc:
  server:
    port: 9081

spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:catalog_configuration}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    schemas: catalog_configuration

# ─────────────────────────────────────────────────────────────────────────────
# gRPC Clients
# ─────────────────────────────────────────────────────────────────────────────
grpc:
  client:
    pricing-service:
      address: ${PRICING_SERVICE_GRPC_ADDRESS:static://localhost:9082}
      negotiation-type: PLAINTEXT
      enable-keep-alive: true
    media-service:
      address: ${MEDIA_SERVICE_GRPC_ADDRESS:static://localhost:9087}
      negotiation-type: PLAINTEXT

# ─────────────────────────────────────────────────────────────────────────────
# Domain Configuration
# ─────────────────────────────────────────────────────────────────────────────
catalog:
  configuration:
    # Dimension constraints (in centimeters)
    dimensions:
      min-width: 50
      max-width: 400
      min-height: 50
      max-height: 400
      max-area: 100000  # 10 sq meters

    # Validation rules cache
    rules-cache:
      enabled: true
      ttl-minutes: 30

    # Default locale for localized strings
    default-locale: ru

# ─────────────────────────────────────────────────────────────────────────────
# Kafka Topics
# ─────────────────────────────────────────────────────────────────────────────
kafka:
  topics:
    product-published: catalog.product.published
    catalog-version-published: catalog.version.published
    configuration-validated: catalog.configuration.validated

# ─────────────────────────────────────────────────────────────────────────────
# Resilience4j
# ─────────────────────────────────────────────────────────────────────────────
resilience4j:
  circuitbreaker:
    instances:
      pricingService:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10s
      mediaService:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5s
  retry:
    instances:
      pricingService:
        max-attempts: 3
        wait-duration: 500ms
      mediaService:
        max-attempts: 2
        wait-duration: 200ms
