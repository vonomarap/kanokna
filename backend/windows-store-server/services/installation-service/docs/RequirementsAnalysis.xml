<RequirementsAnalysis version="1.0">
  <Domain id="installation">
    <Description>
      Manages installation slot scheduling and updates for window/door orders, coordinating installers,
      customer preferences, and order-service state transitions.
    </Description>
  </Domain>

  <Actors>
    <Actor id="CUSTOMER">
      <Name>Customer</Name>
      <Goals>
        <Goal id="G-INSTALL-BOOK">Book or confirm an installation slot</Goal>
        <Goal id="G-INSTALL-RESCHEDULE">Reschedule when needed</Goal>
      </Goals>
    </Actor>
    <Actor id="INSTALLER">
      <Name>Installer</Name>
      <Goals>
        <Goal id="G-INSTALL-AVAILABILITY">Set availability and accept jobs</Goal>
        <Goal id="G-INSTALL-UPDATE">Update job status</Goal>
      </Goals>
    </Actor>
    <Actor id="ORDER_SERVICE">
      <Name>OrderService</Name>
      <Goals>
        <Goal id="G-INSTALL-STATE">Advance order state when installation scheduled/completed</Goal>
      </Goals>
    </Actor>
  </Actors>

  <UseCases>
    <UseCase id="UC-INSTALL-SLOT-SEARCH">
      <ActorRef ref="CUSTOMER"/>
      <Action>Searches available slots</Action>
      <Goal>Find available installation windows</Goal>
      <Preconditions>Order exists and is eligible for scheduling.</Preconditions>
      <Postconditions>Available slots returned.</Postconditions>
      <MainFlow>User requests slots -> service queries availability -> returns options.</MainFlow>
      <AlternateFlows>No slots available -> empty list.</AlternateFlows>
      <Links>
        <Link ref="DevelopmentPlan.xml#Flow-Schedule"/>
      </Links>
    </UseCase>

    <UseCase id="UC-INSTALL-BOOK">
      <ActorRef ref="CUSTOMER"/>
      <ActorRef ref="INSTALLER"/>
      <Action>Books a slot</Action>
      <Goal>Reserve installation time</Goal>
      <Preconditions>Slot available; order eligible.</Preconditions>
      <Postconditions>Slot reserved; order-service notified.</Postconditions>
      <MainFlow>User selects slot -> service reserves -> emits event -> order-service updates.</MainFlow>
      <AlternateFlows>Slot taken -> conflict error; invalid order state -> reject.</AlternateFlows>
    </UseCase>

    <UseCase id="UC-INSTALL-UPDATE">
      <ActorRef ref="INSTALLER"/>
      <Action>Updates installation status</Action>
      <Goal>Reflect progress (scheduled, in-progress, completed)</Goal>
      <Preconditions>Job assigned.</Preconditions>
      <Postconditions>Status updated; events emitted.</Postconditions>
      <MainFlow>Installer updates status -> service records -> emits event.</MainFlow>
      <AlternateFlows>Invalid transition -> reject.</AlternateFlows>
    </UseCase>
  </UseCases>

  <NonFunctionalRequirements>
    <Requirement id="NFR-PERF">P95 slot search <=200ms; booking <=150ms.</Requirement>
    <Requirement id="NFR-AVAILABILITY">99.9% for booking/search APIs.</Requirement>
    <Requirement id="NFR-CONSISTENCY">Booking is atomic and idempotent per order+slot.</Requirement>
    <Requirement id="NFR-SECURITY">OAuth2/OIDC JWT; role-based access; input validation.</Requirement>
  </NonFunctionalRequirements>

  <Links>
    <Link ref="Technology.xml"/>
    <Link ref="DevelopmentPlan.xml"/>
  </Links>
</RequirementsAnalysis>
