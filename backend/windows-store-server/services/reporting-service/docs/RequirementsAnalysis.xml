<RequirementsAnalysis version="1.0">
  <Domain id="reporting">
    <Description>
      Aggregates and serves operational and sales analytics for windows/doors, including conversion,
      product performance, pricing errors, and installation throughput, using event-driven ingestion.
    </Description>
  </Domain>

  <Actors>
    <Actor id="ADMIN">
      <Name>Admin/Analyst</Name>
      <Goals>
        <Goal id="G-REPORT-DASH">View dashboards (sales, conversion, product performance)</Goal>
        <Goal id="G-REPORT-EXPORT">Export data for BI</Goal>
      </Goals>
    </Actor>
    <Actor id="SYSTEM">
      <Name>InternalServiceConsumer</Name>
      <Goals>
        <Goal id="G-REPORT-API">Query aggregated metrics programmatically</Goal>
      </Goals>
    </Actor>
  </Actors>

  <UseCases>
    <UseCase id="UC-REPORT-DASHBOARD">
      <ActorRef ref="ADMIN"/>
      <Action>Views dashboards</Action>
      <Goal>See KPIs like sales, conversion, pricing error rate, installation throughput</Goal>
      <Preconditions>Aggregated data available.</Preconditions>
      <Postconditions>Dashboard data returned within SLA.</Postconditions>
      <MainFlow>User requests dashboard -> service queries read-optimized store -> returns aggregates.</MainFlow>
      <AlternateFlows>No data -> return empty sets.</AlternateFlows>
    </UseCase>

    <UseCase id="UC-REPORT-EXPORT">
      <ActorRef ref="ADMIN"/>
      <Action>Exports data (CSV/JSON)</Action>
      <Goal>Perform offline analysis</Goal>
      <Preconditions>Export filters provided.</Preconditions>
      <Postconditions>Export file generated or download link returned.</Postconditions>
      <MainFlow>User requests export -> job runs -> returns file or link.</MainFlow>
      <AlternateFlows>Too large -> paginated exports or async job.</AlternateFlows>
    </UseCase>

    <UseCase id="UC-REPORT-QUERY-API">
      <ActorRef ref="SYSTEM"/>
      <Action>Queries aggregated metrics via API</Action>
      <Goal>Use metrics for automation/alerting</Goal>
      <Preconditions>API credentials authorized.</Preconditions>
      <Postconditions>Metrics returned.</Postconditions>
      <MainFlow>Service call -> query executed -> result returned.</MainFlow>
      <AlternateFlows>Unauthorized -> 403.</AlternateFlows>
    </UseCase>
  </UseCases>

  <NonFunctionalRequirements>
    <Requirement id="NFR-PERF">P95 dashboard queries <=300ms on warm cache; exports may be async.</Requirement>
    <Requirement id="NFR-AVAILABILITY">99.5% availability for reporting APIs.</Requirement>
    <Requirement id="NFR-DATA-LATENCY">Ingestion-to-availability latency <=5 minutes for key events.</Requirement>
    <Requirement id="NFR-SECURITY">OAuth2/OIDC JWT; role-based access (ADMIN/ANALYST/SERVICE); PII minimization.</Requirement>
  </NonFunctionalRequirements>

  <Links>
    <Link ref="Technology.xml"/>
    <Link ref="DevelopmentPlan.xml"/>
  </Links>
</RequirementsAnalysis>
