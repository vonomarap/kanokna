<RequirementsAnalysis version="1.0">
  <Domain id="search">
    <Description>
      Provides full-text and faceted search, autocomplete, and suggestions over windows/doors products and catalog
      templates, ingesting updates from catalog/publishing events.
    </Description>
  </Domain>

  <Actors>
    <Actor id="CUSTOMER">
      <Name>Customer</Name>
      <Goals>
        <Goal id="G-SEARCH-FIND">Find relevant products quickly</Goal>
        <Goal id="G-SEARCH-AUTOCOMPLETE">Get autocomplete suggestions</Goal>
      </Goals>
    </Actor>
    <Actor id="SYSTEM">
      <Name>InternalServiceConsumer</Name>
      <Goals>
        <Goal id="G-SEARCH-INDEX">Keep search index updated from catalog</Goal>
      </Goals>
    </Actor>
  </Actors>

  <UseCases>
    <UseCase id="UC-SEARCH-BROWSE">
      <ActorRef ref="CUSTOMER"/>
      <Action>Performs faceted search</Action>
      <Goal>Retrieve products/templates matching filters and text</Goal>
      <Preconditions>Index up to date.</Preconditions>
      <Postconditions>Results returned with facets and pagination.</Postconditions>
      <MainFlow>User issues search -> service queries index -> returns hits/facets.</MainFlow>
      <AlternateFlows>No matches -> empty results.</AlternateFlows>
      <Links>
        <Link ref="DevelopmentPlan.xml#Flow-Search"/>
      </Links>
    </UseCase>

    <UseCase id="UC-SEARCH-AUTOCOMPLETE">
      <ActorRef ref="CUSTOMER"/>
      <Action>Requests autocomplete suggestions</Action>
      <Goal>Get quick suggestions while typing</Goal>
      <Preconditions>Index has suggestion data.</Preconditions>
      <Postconditions>Suggestions returned.</Postconditions>
      <MainFlow>User types -> service returns suggestions.</MainFlow>
      <AlternateFlows>No suggestions -> empty list.</AlternateFlows>
    </UseCase>

    <UseCase id="UC-SEARCH-INDEX-UPDATE">
      <ActorRef ref="SYSTEM"/>
      <Action>Updates index based on catalog events</Action>
      <Goal>Keep search results fresh</Goal>
      <Preconditions>Catalog publish events emitted.</Preconditions>
      <Postconditions>Index updated for relevant documents.</Postconditions>
      <MainFlow>Event received -> transforms to index document -> upserts into search index.</MainFlow>
      <AlternateFlows>Index error -> retry/backoff; DLQ on repeated failure.</AlternateFlows>
    </UseCase>
  </UseCases>

  <NonFunctionalRequirements>
    <Requirement id="NFR-PERF">P95 search <=200ms; autocomplete <=100ms.</Requirement>
    <Requirement id="NFR-AVAILABILITY">99.9% availability for search endpoints.</Requirement>
    <Requirement id="NFR-CONSISTENCY">Index updated within SLA after catalog publish.</Requirement>
    <Requirement id="NFR-SECURITY">Public search endpoints protected by rate limiting; admin/index APIs secured.</Requirement>
  </NonFunctionalRequirements>

  <Links>
    <Link ref="Technology.xml"/>
    <Link ref="DevelopmentPlan.xml"/>
  </Links>
</RequirementsAnalysis>
