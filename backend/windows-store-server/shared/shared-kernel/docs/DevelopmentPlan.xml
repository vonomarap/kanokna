<DevelopmentPlan version="1.0">
  <Service id="Service-shared-kernel">
    <Description>Shared domain primitives (value objects, enums, domain events) with no framework dependencies.</Description>
    <BoundedContext>shared-kernel</BoundedContext>
    <Responsibilities>
      <Item>Provide stable Money, Currency, Dimensions, LocalizedString, Id value objects</Item>
      <Item>Define DomainEvent interface with required metadata</Item>
      <Item>Offer reusable validation utilities for primitives</Item>
    </Responsibilities>
    <Dependencies/>
    <Links>
      <Link ref="RequirementsAnalysis.xml#UC-MONEY"/>
      <Link ref="RequirementsAnalysis.xml#UC-DIMENSIONS"/>
    </Links>
  </Service>

  <Architecture>
    <Layers>
      <Domain>com.kanokna.shared.* (only domain/value object code)</Domain>
    </Layers>
    <Enforcement>ArchUnit: module must not depend on Spring, JPA, servlet, or messaging packages.</Enforcement>
  </Architecture>

  <Contracts id="Contracts">
    <ModuleContract id="mod.shared.kernel" layer="domain">
      <Purpose>Define immutable, validated primitives reused across services.</Purpose>
      <Links>
        <Link ref="RequirementsAnalysis.xml#UC-MONEY"/>
        <Link ref="RequirementsAnalysis.xml#UC-DOMAIN-EVENT"/>
      </Links>
      <FunctionContracts>
        <FunctionContract id="Money.of" layer="domain" intent="Create Money from amount and currency with validation">
          <Input>amount, currency</Input>
          <Output>Money</Output>
          <Preconditions>amount not null; currency valid ISO code</Preconditions>
          <Postconditions>Money created or exception thrown; amount normalized</Postconditions>
          <BlockAnchors>
            <Block id="MNY-VALIDATE" purpose="Validate nulls and currency code"/>
            <Block id="MNY-NORMALIZE" purpose="Normalize scale with rounding policy"/>
          </BlockAnchors>
          <LoggingPattern>[SHARED][money.of][block={id}][state={state}]</LoggingPattern>
        </FunctionContract>
        <FunctionContract id="DimensionsCm.of" layer="domain" intent="Create validated dimensions">
          <Input>widthCm, heightCm</Input>
          <Output>DimensionsCm</Output>
          <Preconditions>Width/height provided</Preconditions>
          <Postconditions>Values within configured min/max; otherwise exception</Postconditions>
          <BlockAnchors>
            <Block id="DIM-RANGE" purpose="Check min/max bounds"/>
          </BlockAnchors>
          <LoggingPattern>[SHARED][dimensions.of][block={id}][state={state}]</LoggingPattern>
        </FunctionContract>
        <FunctionContract id="Id.of" layer="domain" intent="Wrap and validate UUID string">
          <Input>string value</Input>
          <Output>Id</Output>
          <Preconditions>Non-empty string</Preconditions>
          <Postconditions>Valid UUID wrapped; invalid input raises exception</Postconditions>
          <BlockAnchors>
            <Block id="ID-PARSE" purpose="Parse UUID and validate format"/>
          </BlockAnchors>
          <LoggingPattern>[SHARED][id.of][block={id}][state={state}]</LoggingPattern>
        </FunctionContract>
      </FunctionContracts>
    </ModuleContract>
  </Contracts>

  <TestingStrategy>
    <Unit>Cover all value object factories, equality, arithmetic, and invariants</Unit>
    <Mutation>Optional Pitest for Money/Dimensions critical logic</Mutation>
    <Architecture>ArchUnit to guard against forbidden dependencies</Architecture>
  </TestingStrategy>

  <Observability>
    <Logging>Value objects avoid logging sensitive data; consuming services handle logging.</Logging>
  </Observability>

  <Deployment>
    <Packaging>Published as Maven module without Spring Boot plugin</Packaging>
    <Versioning>Semantic versioning; breaking changes coordinated across services</Versioning>
  </Deployment>
</DevelopmentPlan>
